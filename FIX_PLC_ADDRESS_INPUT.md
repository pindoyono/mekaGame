# Fix: PLC Editor - Address Input Problem

## üêõ Masalah yang Dilaporkan:

User melaporkan: **"saat saya coba di editor input I0.0 semua dan Q.0 sepertinya itu bermasalah"**

Dari screenshot yang diberikan, terlihat bahwa:

- ‚ùå Semua komponen NO/NC menampilkan address **I0.0**
- ‚ùå Semua komponen COIL menampilkan address **Q0.0**
- ‚ùå Tidak ada cara untuk mengubah address komponen
- ‚ùå User tidak bisa membuat I0.1, I0.2, Q0.1, Q0.2, dll

## üîç Root Cause Analysis:

### **Problem 1: Hard-coded Default Address**

**File:** `app/levels/level10/page.tsx` line 319

```typescript
const getDefaultAddress = (type: ComponentType): string => {
  switch (type) {
    case "NO":
    case "NC":
      return "I0.0"; // ‚ùå ALWAYS returns I0.0!
    case "COIL":
      return "Q0.0"; // ‚ùå ALWAYS returns Q0.0!
    case "TON":
      return "T1";
    case "CTU":
      return "C1";
    default:
      return "";
  }
};
```

**Impact:**

- Semua NO/NC contact dibuat dengan address "I0.0"
- Semua COIL dibuat dengan address "Q0.0"
- User tidak bisa membuat ladder logic dengan multiple inputs/outputs

### **Problem 2: No Edit Functionality**

**Original Code:**

```typescript
const addComponent = (rung: number, col: number) => {
  if (selectedTool === "EMPTY") return;

  const newComponent: LadderComponent = {
    id: `comp_${Date.now()}`,
    type: selectedTool,
    address: getDefaultAddress(selectedTool), // ‚ùå Always same address
    position: { rung, col },
    preset: selectedTool === "TON" ? 3 : selectedTool === "CTU" ? 5 : undefined,
    accum: 0,
  };

  setLadder([...ladder, newComponent]); // ‚ùå No way to change address!
};
```

**Impact:**

- No `editComponent()` function
- No way to change address after component is placed
- User stuck with default addresses

### **Problem 3: Click to Remove Only**

**Original UI:**

```tsx
<div
  className="bg-blue-600 text-white px-4 py-2 rounded-lg"
  onClick={() => removeComponent(component.id)} // ‚ùå Only removes
>
  {component.address} // Shows I0.0 for all
</div>
```

**Impact:**

- Clicking component removes it completely
- No edit functionality
- User has to delete and recreate to try changing address (which still uses default)

## ‚úÖ Solusi yang Diimplementasikan:

### **Fix 1: Prompt for Address on Add**

```typescript
const addComponent = (rung: number, col: number) => {
  if (selectedTool === "EMPTY") return;

  // ‚úÖ Prompt for address
  const defaultAddr = getDefaultAddress(selectedTool);
  let addressPrompt = "";

  if (selectedTool === "NO" || selectedTool === "NC") {
    addressPrompt = `Masukkan address input (I0.0, I0.1, I0.2, I0.3, T1, C1):`;
  } else if (selectedTool === "COIL") {
    addressPrompt = `Masukkan address output (Q0.0, Q0.1, Q0.2):`;
  } else if (selectedTool === "TON") {
    addressPrompt = `Masukkan address timer (T1, T2, T3):`;
  } else if (selectedTool === "CTU") {
    addressPrompt = `Masukkan address counter (C1, C2, C3):`;
  }

  const address = window.prompt(addressPrompt, defaultAddr);
  if (!address) return; // User cancelled

  // ‚úÖ Prompt for preset if timer or counter
  let preset = undefined;
  if (selectedTool === "TON") {
    const presetStr = window.prompt("Masukkan preset timer (detik):", "3");
    preset = presetStr ? parseInt(presetStr) : 3;
  } else if (selectedTool === "CTU") {
    const presetStr = window.prompt("Masukkan preset counter:", "5");
    preset = presetStr ? parseInt(presetStr) : 5;
  }

  const newComponent: LadderComponent = {
    id: `comp_${Date.now()}`,
    type: selectedTool,
    address: address.trim(), // ‚úÖ User-provided address
    position: { rung, col },
    preset: preset, // ‚úÖ User-provided preset
    accum: 0,
  };

  setLadder([...ladder, newComponent]);
};
```

### **Fix 2: Add Edit Component Function**

```typescript
const editComponent = (id: string) => {
  const component = ladder.find((c) => c.id === id);
  if (!component) return;

  // ‚úÖ Prompt for new address
  let addressPrompt = "";
  if (component.type === "NO" || component.type === "NC") {
    addressPrompt = `Edit address input (I0.0, I0.1, I0.2, I0.3, T1, C1):`;
  } else if (component.type === "COIL") {
    addressPrompt = `Edit address output (Q0.0, Q0.1, Q0.2):`;
  } else if (component.type === "TON") {
    addressPrompt = `Edit address timer (T1, T2, T3):`;
  } else if (component.type === "CTU") {
    addressPrompt = `Edit address counter (C1, C2, C3):`;
  }

  const newAddress = window.prompt(addressPrompt, component.address);
  if (newAddress === null) return; // User cancelled

  // ‚úÖ Prompt for preset if timer or counter
  let newPreset = component.preset;
  if (component.type === "TON" || component.type === "CTU") {
    const presetStr = window.prompt(
      `Edit preset ${component.type === "TON" ? "(detik)" : "(count)"}:`,
      component.preset?.toString() || "3"
    );
    newPreset = presetStr ? parseInt(presetStr) : component.preset;
  }

  // ‚úÖ Update component in ladder
  setLadder(
    ladder.map((c) =>
      c.id === id ? { ...c, address: newAddress.trim(), preset: newPreset } : c
    )
  );
};
```

### **Fix 3: Updated UI with Edit/Remove**

```tsx
<div className="relative group">
  <div
    className="bg-blue-600 text-white px-4 py-2 rounded-lg font-mono text-sm cursor-pointer hover:bg-blue-700"
    onClick={() => editComponent(component.id)} // ‚úÖ Click to Edit
    onContextMenu={(e) => {
      e.preventDefault();
      removeComponent(component.id); // ‚úÖ Right-click to Remove
    }}
  >
    {getComponentIcon(component.type)}
    <br />
    <span className="text-xs font-bold">
      {component.address} // ‚úÖ Shows user-entered address
    </span>
    {component.preset && (
      <div className="text-xs">
        PT: {component.preset}
        {component.type === "TON" ? "s" : ""}
      </div>
    )}
  </div>

  {/* ‚úÖ New tooltip */}
  <div className="absolute -top-10 left-0 bg-blue-800 text-white px-2 py-1 rounded text-xs opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap z-10">
    Click: Edit | Right-click: Remove
  </div>
</div>
```

## üéÆ Cara Kerja Baru:

### **Skenario 1: Menambah Komponen Baru**

```
1. User pilih tool "NO" (Normally Open)
2. User klik pada grid (Rung 0, Col 0)
3. ‚úÖ Dialog muncul: "Masukkan address input (I0.0, I0.1, I0.2, I0.3, T1, C1):"
4. User ketik: I0.1
5. Komponen dibuat dengan address I0.1 ‚úÖ
```

### **Skenario 2: Menambah Output dengan Address Berbeda**

```
1. User pilih tool "COIL"
2. User klik pada grid (Rung 0, Col 3)
3. ‚úÖ Dialog muncul: "Masukkan address output (Q0.0, Q0.1, Q0.2):"
4. User ketik: Q0.1
5. Komponen dibuat dengan address Q0.1 ‚úÖ
```

### **Skenario 3: Edit Komponen yang Sudah Ada**

```
1. User melihat komponen dengan address I0.0 (salah)
2. User klik komponen tersebut
3. ‚úÖ Dialog muncul: "Edit address input (I0.0, I0.1, I0.2, I0.3, T1, C1):"
4. User ubah ke: I0.2
5. Address komponen berubah menjadi I0.2 ‚úÖ
```

### **Skenario 4: Hapus Komponen**

```
1. User right-click komponen
2. ‚úÖ Komponen terhapus
```

### **Skenario 5: Menambah Timer dengan Preset Custom**

```
1. User pilih tool "TON"
2. User klik grid
3. ‚úÖ Dialog 1: "Masukkan address timer (T1, T2, T3):"
   User ketik: T2
4. ‚úÖ Dialog 2: "Masukkan preset timer (detik):"
   User ketik: 5
5. Timer dibuat: T2 dengan preset 5 detik ‚úÖ
```

## üìä Before vs After:

### **BEFORE:**

```
User Action: Click + to add NO contact
Result: ‚ùå Component created with I0.0 (always same)

User Action: Click + to add another NO contact
Result: ‚ùå Component created with I0.0 (duplicate address!)

User Action: Click component
Result: ‚ùå Component removed (no edit option)

User Action: Try to make I0.1
Result: ‚ùå IMPOSSIBLE! No way to change address
```

**Ladder Logic yang Dihasilkan:**

```
‚ùå WRONG:
Rung 0: ‚îÄ‚î§I0.0‚îú‚îÄ‚îÄ‚î§I0.0‚îú‚îÄ‚îÄ‚î§I0.0‚îú‚îÄ‚îÄ(Q0.0)‚îÄ
         ALL same address!
```

### **AFTER:**

```
User Action: Click + to add NO contact
Result: ‚úÖ Prompt: "Masukkan address input..."
        User enters: I0.0
        Component created with I0.0

User Action: Click + to add another NO contact
Result: ‚úÖ Prompt: "Masukkan address input..."
        User enters: I0.1
        Component created with I0.1 ‚úÖ

User Action: Click component
Result: ‚úÖ Edit prompt appears, user can change address

User Action: Right-click component
Result: ‚úÖ Component removed
```

**Ladder Logic yang Dihasilkan:**

```
‚úÖ CORRECT:
Rung 0: ‚îÄ‚î§I0.0‚îú‚îÄ‚îÄ‚î§I0.1‚îú‚îÄ‚îÄ‚î§I0.2‚îú‚îÄ‚îÄ(Q0.0)‚îÄ
         Different addresses!
```

## üéØ Challenge Examples:

### **Challenge 2: Start/Stop Motor**

**BEFORE:**

```
‚ùå User tries to make:
Rung 0: ‚îÄ‚î§I0.1‚îú‚îÄ‚îÄ‚î§I0.0‚îú‚îÄ‚îÄ(Q0.0)‚îÄ
        [STOP]  [START]

But gets:
‚ùå ‚îÄ‚î§I0.0‚îú‚îÄ‚îÄ‚î§I0.0‚îú‚îÄ‚îÄ(Q0.0)‚îÄ
    Both same address!
```

**AFTER:**

```
‚úÖ User clicks + for NC contact
   Dialog: "Masukkan address input..."
   User enters: I0.1

‚úÖ User clicks + for NO contact
   Dialog: "Masukkan address input..."
   User enters: I0.0

Result:
‚úÖ ‚îÄ‚î§I0.1‚îú‚îÄ‚îÄ‚î§I0.0‚îú‚îÄ‚îÄ(Q0.0)‚îÄ
    [STOP]  [START]  Correct!
```

## üîß Technical Details:

### **Prompt System:**

1. **window.prompt()** digunakan untuk input
2. **Default value** ditampilkan (I0.0, Q0.0, dll)
3. **User bisa cancel** dengan klik Cancel atau kosong
4. **trim()** untuk remove whitespace
5. **parseInt()** untuk preset values

### **Component State Update:**

```typescript
// Update uses map() to replace specific component
setLadder(
  ladder.map((c) =>
    c.id === id ? { ...c, address: newAddress.trim(), preset: newPreset } : c
  )
);
```

### **UI Event Handling:**

- **onClick**: Edit component
- **onContextMenu**: Remove component (right-click)
- **Tooltip**: Shows instructions on hover

## ‚úÖ Testing:

### **Test Case 1: Multiple Inputs**

```
1. Add NO contact ‚Üí Enter I0.0
2. Add NO contact ‚Üí Enter I0.1
3. Add NO contact ‚Üí Enter I0.2
4. ‚úÖ All three show different addresses
```

### **Test Case 2: Multiple Outputs**

```
1. Add COIL ‚Üí Enter Q0.0
2. Add COIL ‚Üí Enter Q0.1
3. Add COIL ‚Üí Enter Q0.2
4. ‚úÖ All three show different addresses
```

### **Test Case 3: Edit Address**

```
1. Add NO contact with I0.0
2. Click component
3. Change to I0.3
4. ‚úÖ Address updates to I0.3
```

### **Test Case 4: Timer with Custom Preset**

```
1. Add TON timer
2. Enter address: T2
3. Enter preset: 10
4. ‚úÖ Timer shows T2 with PT: 10s
```

### **Test Case 5: Remove Component**

```
1. Add any component
2. Right-click component
3. ‚úÖ Component removed from grid
```

## üìù Status:

- ‚úÖ Address prompt added for all component types
- ‚úÖ Edit functionality implemented
- ‚úÖ Remove via right-click
- ‚úÖ Preset prompts for timer/counter
- ‚úÖ UI tooltip shows instructions
- ‚úÖ No compilation errors
- ‚úÖ Ready for testing!

## üéâ Result:

User sekarang bisa:

1. ‚úÖ Membuat komponen dengan address custom (I0.0, I0.1, I0.2, dll)
2. ‚úÖ Edit address komponen yang sudah ada
3. ‚úÖ Membuat ladder logic yang kompleks dengan multiple inputs/outputs
4. ‚úÖ Menyelesaikan Challenge 2 (Start/Stop dengan I0.0 dan I0.1)
5. ‚úÖ Menggunakan different addresses untuk setiap komponen

**Problem solved!** üöÄ
